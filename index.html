<html lang="uk"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мобільний Інтерфейс</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* === CSS Стилі === */

        /* Скидання базових стилів та налаштування для мобільного вигляду */
        body, html { /* Додано: html для забезпечення повної висоти */
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            height: 100%; /* Додано: Повна висота */
            display: flex;
            flex-direction: column;
        }

        /* Обмеження вмісту для імітації мобільного екрана */
        #app-container {
            width: 100%;
            max-width: 480px; /* Типовий максимум для мобільних пристроїв */
            margin: 0 auto;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            /* Змінено: min-height: 100vh; -> height: 100%; */
            height: 100%; /* Гарантуємо повну висоту в межах max-width */
        }
        
        /* НОВИЙ КОНТЕЙНЕР ДЛЯ ВСЬОГО ВМІСТУ, ЯКИЙ ВІДТІСНЯЄ НАВІГАЦІЮ ВНИЗ */
        #content-wrapper {
            flex-grow: 1; /* Зайняти весь вільний простір */
            display: flex;
            flex-direction: column;
            overflow-y: auto; 
            position: relative; /* Додано: для позиціонування .content.active-tab */
        }

        /* Вміст сторінки (одна вкладка) */
        .content { 
            flex-grow: 1; /* Вміст вкладки займає весь простір всередині #content-wrapper */
            padding: 20px;
            text-align: center;
            /* Додаємо базовий клас для вмісту, щоб полегшити скидання стилів */
            visibility: hidden; 
            position: absolute; /* Приховуємо та виводимо з потоку */
            width: 100%;
            height: 100%; /* Повна висота обгортки */
            top: 0;
            left: 0;
            box-sizing: border-box;
            background-color: #fff;
            overflow-y: auto; /* Дозволяє скрол вмісту вкладки */
        }
        
        /* Клас для активного вмісту */
        .content.active-tab {
            visibility: visible;
            position: relative; /* Повертаємо в потік, коли активна */
        }


        /* Стилі для розділу "Замовлення" */
        #orders-content {
            display: flex;
            flex-direction: column;
            justify-content: center; /* Центруємо кнопку по вертикалі */
            align-items: center;
        }

        /* Кругла кнопка "Зробити замовлення" */
        #order-button {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background-color: #007bff;
            color: white;
            border: none;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        /* ... (Інші стилі, що не змінювалися) ... */
        
        /* Стилі для розділу "Мої купони" */
        #coupons-content {
            color: #6c757d;
        }
        
        /* Стилі для розділу "Профіль" */
        #profile-content {
            text-align: center;
            padding: 20px;
            display: flex;
            flex-direction: column; 
            justify-content: flex-start;
        }

        .profile-pic-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            background-color: #ddd;
        }

        #profile-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            cursor: pointer;
        }

        .change-photo-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30%;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            cursor: pointer;
        }
        
        .name-display {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            display: inline-block;
        }

        /* Стилі для плаваючої кнопки (FAB) */
        #promocodes-button {
            width: 50px; 
            height: 50px; 
            padding: 0;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 50%; 
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            position: fixed; 
            bottom: 85px; 
            /* Змінено для центрування по горизонталі в межах app-container */
            right: calc(50% - 480px / 2 + 15px); /* Адаптуємо позицію під max-width */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 5; 
            display: none; 
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s, transform 0.2s;
        }
        
        @media (max-width: 480px) { /* Якщо ширина менша за max-width, повертаємо до правого краю екрана */
             #promocodes-button {
                right: 15px; 
            }
        }

        #promocodes-button:active {
            transform: scale(0.95);
        }
        
        #promocodes-button span {
            display: none;
        }

        /* Стилі для модального вікна */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 10; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4); 
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; 
            padding: 20px;
            border: 1px solid #888;
            width: 80%; 
            max-width: 400px;
            border-radius: 10px;
            position: relative;
            animation: slideIn 0.3s ease-out;
            text-align: left; 
        }
        
        @keyframes slideIn {
            from {transform: translateY(-50px); opacity: 0}
            to {transform: translateY(0); opacity: 1}
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-button:hover,
        .close-button:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        /* Стилі для поля вводу */
        #promo-input {
            width: calc(100% - 10px);
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            text-transform: uppercase;
        }

        #activate-promo-btn {
            width: 100%;
            padding: 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #activate-promo-btn:hover {
            background-color: #1e7e34;
        }
        
        #promo-message {
            margin-top: 15px;
            font-weight: bold;
            text-align: center;
        }
        
        /* Стилі для списку промокодів (коли ROMA123 введено) */
        .promocode-list {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }
        
        .promocode-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            font-size: 0.95em;
        }
        
        .promocode-list li:last-child {
            border-bottom: none;
        }
        
        .promocode-list .code {
            font-weight: bold;
            color: #007bff;
        }
        
        .promocode-list .value {
            color: #28a745;
            font-weight: bold;
        }


        /* Нижня навігаційна панель */
        #bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 60px;
            background-color: #fff;
            border-top: 1px solid #ddd;
            flex-shrink: 0; 
            z-index: 10; 
        }

        .nav-item {
            text-align: center;
            color: #6c757d;
            padding: 5px;
            cursor: pointer;
            flex-grow: 1;
            transition: color 0.3s ease;
        }

        .nav-item.active {
            color: #007bff;
        }

        .nav-item i {
            font-size: 1.2em;
            display: block;
            margin-bottom: 2px;
        }
        
        /* Анімація переходу (Fade Out) */
        .fade-out {
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
    </style>
</head>
<body>

    <div id="app-container">

        <div id="content-wrapper"> 
            
            <div id="orders-content" class="content">
                <button id="order-button">
                    Зробити замовлення
                </button>
            </div>

            <div id="coupons-content" class="content">
                <h2>Мої Купони</h2>
                <p>Тут відображатимуться ваші доступні купони.</p>
                <i class="fas fa-ticket-alt" style="font-size: 3em; margin-top: 20px;"><p id="coupon-count">2</p></i>
            </div>
            
            <div id="profile-content" class="content">
                <h2>Профіль</h2>
                <div class="profile-pic-container">
                    <img id="profile-image" src="https://via.placeholder.com/120/007bff/ffffff?text=VM" alt="Фото профілю">
                    <div class="change-photo-overlay" onclick="document.getElementById('file-input').click()">
                        <i class="fas fa-camera"></i> Змінити
                    </div>
                </div>
                <input type="file" id="file-input" accept="image/*" style="display: none;">
                
                <div class="name-display" id="user-name">Віталій Мельник <i class="fas fa-pen" style="font-size: 0.8em; margin-left: 5px;"></i></div>
                
                <p style="color: #6c757d; margin-top: 0;">Натисніть на ім'я, щоб змінити його.</p>
                
            </div>

        </div>
        
        <button id="promocodes-button">
            <i class="fas fa-tag"></i> <span>Промокоди</span>
        </button>

        <div id="bottom-nav">
            <div class="nav-item active" data-target="orders-content">
                <i class="fas fa-box-open"></i>
                <span class="nav-text">Замовлення</span>
            </div>
            <div class="nav-item" data-target="coupons-content">
                <i class="fas fa-ticket-alt"></i>
                <span class="nav-text">Мої купони</span>
            </div>
            <div class="nav-item" data-target="profile-content">
                <i class="fas fa-user"></i>
                <span class="nav-text">Профіль</span>
            </div>
        </div>
    </div>

    <div id="promocodes-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-modal-btn">&times;</span>
            <h3>Активувати Промокод</h3>
            
            <input type="text" id="promo-input" placeholder="Введіть промокод">
            <button id="activate-promo-btn">Активувати</button>
            
            <div id="promo-results">
                <p id="promo-message" style="color: #6c757d;">Введіть код для активації.</p>
                <ul class="promocode-list" style="display: none;"></ul>
            </div>
            
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const navItems = document.querySelectorAll('.nav-item');
            const contents = document.querySelectorAll('.content');
            const orderButton = document.getElementById('order-button');
            const appContainer = document.getElementById('app-container');
            
            // --- КОНСТАНТИ ДЛЯ LOCALSTORAGE ---
            const COUPON_COUNT_KEY = 'couponCount';
            const REDEEMED_CODES_KEY = 'redeemedCodes';
            const PROFILE_IMAGE_KEY = 'profileImage';
            const USER_NAME_KEY = 'userName';
            
            const DEFAULT_PROFILE_IMAGE = 'https://via.placeholder.com/120/007bff/ffffff?text=VM';
            const DEFAULT_USER_NAME = 'Віталій Мельник';


            // Елементи Профілю
            const userNameElement = document.getElementById('user-name');
            const profileImage = document.getElementById('profile-image');
            const fileInput = document.getElementById('file-input');
            
            // Елементи Купонів
            const couponCountElement = document.getElementById('coupon-count');


            // --- Ініціалізація: Завантаження даних ---
            
            // 1. Купони
            let couponCount = 0;
            const savedCount = localStorage.getItem(COUPON_COUNT_KEY);
            if (savedCount !== null && !isNaN(parseInt(savedCount, 10))) {
                couponCount = parseInt(savedCount, 10);
            } else {
                couponCount = 2; // Початкова кількість купонів
                localStorage.setItem(COUPON_COUNT_KEY, couponCount);
            }
            couponCountElement.textContent = couponCount;

            // 2. Використані промокоди
            let redeemedCodes = JSON.parse(localStorage.getItem(REDEEMED_CODES_KEY) || '[]');
            
            // 3. Фото профілю
            const savedImage = localStorage.getItem(PROFILE_IMAGE_KEY);
            profileImage.src = savedImage || DEFAULT_PROFILE_IMAGE;

            // 4. Ім'я користувача
            const savedName = localStorage.getItem(USER_NAME_KEY);
            const initialName = savedName || DEFAULT_USER_NAME;
            userNameElement.innerHTML = `${initialName} <i class="fas fa-pen" style="font-size: 0.8em; margin-left: 5px;"></i>`;


            // -----------------------------------------------------------


            // Елементи Модального вікна
            const promocodesButton = document.getElementById('promocodes-button');
            const modal = document.getElementById('promocodes-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const promoInput = document.getElementById('promo-input');
            const activatePromoBtn = document.getElementById('activate-promo-btn');
            const promoMessage = document.getElementById('promo-message');
            const promocodeList = modal.querySelector('.promocode-list');
            
            // Список промокодів
            const PROMOCODES = {
                'LAST': 1,
                'LOVE': 1,
                'START': 1,
                'ADMIN': 10000000,
                'VOLODYA': 1,
                'VOVA': 1,
                'MAMA': 1,
                'TATO': 1,
                'VITALIK': 1,
                'PROMO1': 1,
                'PROMO2': 1,
                'PROMO3': 1,
                'PROMO4': 1,
                'PROMO5': 1,
                'PROMO6': 1,
                'PROMO7': 1,
                'PROMO8': 1,
                'PROMO9': 1,
                'PROMO10': 1,
                'ROMA123': 0 
            };
            
            const initialTab = 'orders-content';

            // Функція для перемикання вкладок
            function switchTab(targetId) {
                contents.forEach(content => {
                    // Приховуємо вміст
                    content.classList.remove('active-tab'); 
                    content.style.display = 'none'; // Додаткове скидання для WebView
                });

                navItems.forEach(item => {
                    item.classList.remove('active');
                });

                const targetContent = document.getElementById(targetId);
                
                // Відображаємо та налаштовуємо стилі для активної вкладки
                if (targetId === 'orders-content') {
                    targetContent.style.display = 'flex'; 
                    targetContent.style.justifyContent = 'center'; 
                } else if (targetId === 'profile-content') {
                    targetContent.style.display = 'flex'; 
                    targetContent.style.flexDirection = 'column'; 
                    targetContent.style.justifyContent = 'flex-start'; 
                } else {
                    targetContent.style.display = 'block'; 
                }
                
                // Додаємо клас активності
                targetContent.classList.add('active-tab');

                const targetNavItem = document.querySelector(`.nav-item[data-target="${targetId}"]`);
                targetNavItem.classList.add('active');
                
                // Відображати плаваючу кнопку ЛИШЕ на вкладці "Профіль"
                if (targetId === 'profile-content') {
                    promocodesButton.style.display = 'flex';
                } else {
                    promocodesButton.style.display = 'none';
                }
            }

            // Обробник кліку на навігаційні елементи
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    const target = item.getAttribute('data-target');
                    switchTab(target);
                });
            });

            // Обробник кліку на кнопку "Зробити замовлення"
            orderButton.addEventListener('click', () => {
                appContainer.classList.add('fade-out');
                setTimeout(() => {
                    // Змініть 'qwest.html' на потрібну вам сторінку
                    alert('Перехід на сторінку замовлення (qwest.html)'); 
                    // window.location.href = 'qwest.html'; 
                    appContainer.classList.remove('fade-out'); // Для демонстрації
                }, 500);
            });
            
            // *** Функціонал Профілю ***

            // Зміна імені (з збереженням у localStorage)
            userNameElement.addEventListener('click', () => {
                // Витягуємо поточне ім'я, видаляючи іконку олівця
                const currentName = userNameElement.textContent.replace(/\s\s*<i.*?<\/i>\s*$/, '').trim(); 
                const newName = prompt('Введіть нове ім\'я та прізвище:', currentName);
                if (newName !== null && newName.trim() !== '') {
                    const finalName = newName.trim();
                    userNameElement.innerHTML = `${finalName} <i class="fas fa-pen" style="font-size: 0.8em; margin-left: 5px;"></i>`;
                    localStorage.setItem(USER_NAME_KEY, finalName); // Зберігаємо нове ім'я
                }
            });

            // Зміна фото (з збереженням у localStorage)
            profileImage.addEventListener('click', () => {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        profileImage.src = e.target.result;
                        localStorage.setItem(PROFILE_IMAGE_KEY, e.target.result); // Зберігаємо Data URL
                    };
                    reader.readAsDataURL(file);
                }
            });

            // *** Функціонал Промокодів (Модальне вікно) ***
            
            // Наповнення списку промокодів
            function populatePromocodeList() {
                promocodeList.innerHTML = ''; 
                for (const [code, value] of Object.entries(PROMOCODES)) {
                    if (code !== 'ROMA123') { 
                        const listItem = document.createElement('li');
                        // Додаємо статус "Використано"
                        const status = redeemedCodes.includes(code) ? 
                                     `<span style="color: #dc3545; font-style: italic;">(Використано)</span>` : 
                                     `<span class="value">${value}</span> купонів`;

                        listItem.innerHTML = `<span class="code">${code}</span>${status}`;
                        promocodeList.appendChild(listItem);
                    }
                }
            }
            
            // Обробник активації промокоду
            activatePromoBtn.addEventListener('click', () => {
                const enteredCode = promoInput.value.trim().toUpperCase();
                
                // Скидаємо попередній стан
                promoMessage.style.display = 'block';
                promocodeList.style.display = 'none';
                
                if (enteredCode === 'ROMA123') {
                    promoMessage.textContent = 'Секретний код активовано! Список усіх промокодів:';
                    promoMessage.style.color = '#007bff';
                    populatePromocodeList();
                    promocodeList.style.display = 'block';
                } else if (PROMOCODES.hasOwnProperty(enteredCode)) {
                    // Перевірка на повторне використання
                    if (redeemedCodes.includes(enteredCode)) {
                        promoMessage.textContent = `Промокод ${enteredCode} вже був використаний.`;
                        promoMessage.style.color = '#dc3545';
                        return; // Зупиняємо виконання
                    }
                    
                    // Якщо промокод не використано
                    const coupons = PROMOCODES[enteredCode];
                    
                    couponCount += coupons;
                    couponCountElement.textContent = couponCount;
                    localStorage.setItem(COUPON_COUNT_KEY, couponCount); 
                    
                    // Зберігаємо код як використаний
                    redeemedCodes.push(enteredCode);
                    localStorage.setItem(REDEEMED_CODES_KEY, JSON.stringify(redeemedCodes));

                    promoMessage.textContent = `Промокод ${enteredCode} активовано! Ви отримали ${coupons} купонів.`;
                    promoMessage.style.color = '#28a745';
                    promoInput.value = ''; // Очищаємо поле після успішної активації
                    
                    // Оновлюємо кількість купонів на вкладці "Мої купони"
                    const couponsTab = document.getElementById('coupons-content');
                    if (couponsTab.classList.contains('active-tab')) {
                        // Якщо вкладка активна, користувач побачить оновлення при наступному її відкритті
                        // або можна додати невеличку анімацію чи сповіщення.
                    }
                } else {
                    promoMessage.textContent = 'Невірний промокод. Спробуйте ще раз.';
                    promoMessage.style.color = '#dc3545';
                }
            });
            
            // Відкриття модального вікна
            promocodesButton.addEventListener('click', () => {
                // Скидаємо стан модального вікна при відкритті
                promoInput.value = '';
                promoMessage.textContent = 'Введіть код для активації.';
                promoMessage.style.color = '#6c757d';
                promocodeList.style.display = 'none';
                
                modal.style.display = 'block';
            });
            
            // Закриття модального вікна кнопкою X
            closeModalBtn.addEventListener('click', () => {
                modal.style.display = 'none';
            });

            // Закриття модального вікна при кліку поза ним
            window.addEventListener('click', (event) => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            // Встановити початкову вкладку "Замовлення"
            // Запускаємо перемикання після невеликої затримки (200 мс)
            setTimeout(() => {
                switchTab(initialTab);
            }, 200); 

        });
    </script>

</body></html>
